import { ethers } from 'ethers';
import commitmentData from '../test/example/zkobs-p1/0_register-acc1-p5-commitment.json';
import calldata from '../test/example/zkobs-p1/0_register-acc1-p5-8-8-4-8-calldata-raw.json';
const F_field =
  21888242871839275222246405745257275088548364400416034343698204186575808495617n;
const raw253 =
  '1001011010010011000010010000000110000010010111100111001100100101001010001110100101001111110110010111000111001101101001011101101001110101101100000011010010111010000100011110101010111101110010101010101010001000110011001111111101010001001100111011010100011';
const rawSha256 =
  '0101001011010010011000010010000000110000010010111100111001100100101001010001110100101001111110110010111000111001101101001011101101001110101101100000011010010111010000100011110101010111101110010101010101010001000110011001111111101010001001100111011010100011';
const rawSha256r = rawSha256.split('').reverse().join('');
const raw =
  '000011010110000110001001111111101011100001110101101101110100011100100100001011101011011001111000111101010110111100111101100100000111101111000001100100101110011000100000001000110001110001111100000001001110011100000000000010000010100111101111110011111011001000001101001100011010001011101010000010111101010100000001001101000100001100101100011011010101110001011001111011000101101001101000000011111100111000000111011001100101101001001101011110001111011010000010001101101001000001110000010000111101001100000111101110110001110101111100111011101100100100000110000010011001010111100010110000111101100100110101111101101111100111111001100110001010100011111111110110111011110000000000011100101101010011001101011011000010011100010111001000111001001001010100001111011001101001110001000000010000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000110010000000000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010011000100101101000000011011011001110110100100111010001101111011101100101100101100001101111011011000001110100000110110011101101110001111001010001101111000000000110010011110011010010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
async function main() {
  const rawb = {
    a: raw.slice(256 * 0, 256 * 1),
    b: raw.slice(256 * 1, 256 * 2),
    c: raw.slice(256 * 2, 256 * 3),
    d: raw.slice(256 * 3),
  };
  console.log({
    rawb,
    a: toHex('0b' + rawb.a),
    b: toHex('0b' + rawb.b),
    c: toHex('0b' + rawb.c),
    d: toHex('0b' + rawb.d),
    commitmentData,
  });
  const commitmentMessage = ethers.utils.solidityPack(
    ['bytes32', 'bytes32', 'bytes32', 'bytes'],
    [
      commitmentData.oriStateRoot,
      commitmentData.newStateRoot,
      commitmentData.newTsRoot,
      commitmentData.pubdata,
    ],
  );
  const commitmentHashOrigin = ethers.utils.sha256(commitmentMessage);

  const verifyInput = toHex(
    BigInt(
      '0b' +
        BigInt(commitmentHashOrigin).toString(2).padStart(256, '0').slice(3),
    ),
  );

  console.log({
    commitmentMessage,
    commitmentHashOrigin,
    verifyInput,
    actualInput: calldata[3][0],
    isCommitmentSame: verifyInput === calldata[3][0],
  });
}

function toHex(n: string | BigInt) {
  const num = typeof n === 'bigint' ? n : BigInt(n as string);
  const rawHex = num.toString(16);
  return '0x' + (rawHex.length % 2 === 0 ? rawHex : '0' + rawHex);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
